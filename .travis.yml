sudo: required

services:
  - docker

before_install:
  - docker build -t cfboom/lang .

install:
  - docker run -d -p 8888:8888 --rm cfboom/lang:latest

before_script:
  - curl http://localhost:8888/

script: > 
    testResults="echo $(box testbox run runner=http://localhost:45123/modules/cfboom-lang/tests/runner.cfm)";
    echo "$testResults";
    if grep -i "\[Failures: [1-9][0-9]\?[0-9]\?\]\|\[Errors: [1-9][0-9]\?[0-9]\?\]\|<t[^>]*>\|<b[^>]*>" <<< $testResults;  then exit 1; fi

